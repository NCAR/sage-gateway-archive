<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
				   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
				   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd"
				   logicalFilePath="/Liquibase/update-v3/changesets/20150313-GTWY-4244.xml">

	<changeSet id="20150313-GTWY-4244.1" author="sgf">
		<sql>
			CREATE TABLE audit.audit_log
			(
			id bigint NOT NULL,
			app_user text,
			date_updated timestamp with time zone DEFAULT default_timestamp(),
			transaction_id uuid NOT NULL,
			entity_id uuid NOT NULL,
			entity_name text,
			property_name text,
			old_value text,
			new_value text,
			CONSTRAINT pkey_audit_log PRIMARY KEY (id)
			)
			WITH (
			OIDS=FALSE
			);
			ALTER TABLE audit.audit_log
			OWNER TO esgcet_admin;
			GRANT ALL ON TABLE audit.audit_log TO esgcet_admin;
			GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE audit.audit_log TO esgcet_user;
			GRANT SELECT ON TABLE audit.audit_log TO esgcet_reader;
		</sql>
	</changeSet>

	<changeSet id="20150313-GTWY-4244.2" author="sgf">
	<sql>
		CREATE SEQUENCE audit.audit_log_id_seq
		INCREMENT 1
		MINVALUE 1
		MAXVALUE 9223372036854775807
		START 1
		CACHE 1;
		ALTER TABLE audit.audit_log_id_seq
		OWNER TO esgcet_admin;
		GRANT ALL ON TABLE audit.audit_log_id_seq TO esgcet_admin;
		GRANT SELECT, UPDATE ON TABLE audit.audit_log_id_seq TO esgcet_user;
		GRANT SELECT ON TABLE audit.audit_log_id_seq TO esgcet_reader;
	</sql>
	</changeSet>

	<changeSet id="20150313-GTWY-4244.3" author="sgf">
	<sql>
		DROP TABLE audit.audit_log;
		DROP SEQUENCE audit.audit_log_id_seq;
	</sql>
	</changeSet>

	<changeSet id="20150313-GTWY-4244.4" author="sgf">
		<sql>
			CREATE TABLE audit.change_log
			(
			id bigint NOT NULL,
			app_user text,
			date_updated timestamp with time zone DEFAULT default_timestamp(),
			transaction_id uuid NOT NULL,
			entity_id uuid NOT NULL,
			entity_name text,
			property_name text,
			old_value text,
			new_value text,
			CONSTRAINT pkey_audit_log PRIMARY KEY (id)
			)
			WITH (
			OIDS=FALSE
			);
			ALTER TABLE audit.change_log
			OWNER TO esgcet_admin;
			GRANT ALL ON TABLE audit.change_log TO esgcet_admin;
			GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE audit.change_log TO esgcet_user;
			GRANT SELECT ON TABLE audit.change_log TO esgcet_reader;
		</sql>
	</changeSet>

	<changeSet id="20150313-GTWY-4244.5" author="sgf">
		<sql>
			CREATE SEQUENCE audit.change_log_id_seq
			INCREMENT 1
			MINVALUE 1
			MAXVALUE 9223372036854775807
			START 1
			CACHE 1;
			ALTER TABLE audit.change_log_id_seq
			OWNER TO esgcet_admin;
			GRANT ALL ON TABLE audit.change_log_id_seq TO esgcet_admin;
			GRANT SELECT, UPDATE ON TABLE audit.change_log_id_seq TO esgcet_user;
			GRANT SELECT ON TABLE audit.change_log_id_seq TO esgcet_reader;
		</sql>
	</changeSet>

	<changeSet id="20150313-GTWY-4244.6" author="sgf">
	<sql>
		ALTER TABLE audit.change_log RENAME COLUMN entity_id TO dataset_id;
	</sql>
	</changeSet>

</databaseChangeLog>
